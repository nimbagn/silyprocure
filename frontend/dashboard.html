<!DOCTYPE html>
<html lang="fr" class="h-full bg-gray-50">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - SilyProcure</title>
    
    <!-- CSS Charte Graphique Pro Confiance -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#E0E7FF',
                            100: '#DBEAFE',
                            400: '#60A5FA',
                            500: '#3B82F6',
                            600: '#2563EB',
                            700: '#1D4ED8',
                            900: '#1E3A8A',
                        },
                        success: {
                            500: '#10B981',
                        },
                        neutral: {
                            500: '#64748B',
                            600: '#475569',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'Arial', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- Font Awesome & Google Fonts -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Variables CSS selon la charte Pro Confiance */
        :root {
            --color-primary-dark: #1E3A8A;
            --color-primary: #3B82F6;
            --color-primary-light: #60A5FA;
            --color-success: #10B981;
            --color-neutral: #64748B;
            --color-neutral-dark: #475569;
            --color-background: #FFFFFF;
            --color-background-light: #F8FAFC;
            --color-background-blue: #E0E7FF;
        }
        
        body { 
            font-family: 'Inter', sans-serif;
            background-color: var(--color-background-light);
            color: var(--color-neutral-dark);
            line-height: 1.5;
        }
        
        /* Navbar selon charte */
        nav {
            background: var(--color-background) !important;
            border-bottom: 2px solid var(--color-background-blue);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        /* Logo avec couleur charte */
        .logo-primary {
            color: var(--color-primary) !important;
        }
        
        /* Navigation active */
        nav a.border-primary-500 {
            border-bottom-color: var(--color-primary) !important;
            color: var(--color-primary-dark) !important;
            font-weight: 600;
        }
        
        /* Boutons selon charte */
        button.bg-primary-600,
        button.bg-primary-500 {
            background-color: var(--color-primary) !important;
        }
        
        button.bg-primary-600:hover,
        button.bg-primary-500:hover {
            background-color: var(--color-primary-dark) !important;
        }
        
        /* Cartes KPI avec style charte am√©lior√© */
        .kpi-card {
            background: linear-gradient(135deg, var(--color-background) 0%, #FAFBFC 100%);
            border-left: 4px solid var(--color-primary);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08), 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--color-primary), var(--color-primary-light));
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .kpi-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.12), 0 4px 8px rgba(0, 0, 0, 0.08);
        }
        
        .kpi-card:hover::before {
            opacity: 1;
        }
        
        .kpi-card.blue { 
            border-left-color: var(--color-primary);
        }
        .kpi-card.blue::before {
            background: linear-gradient(90deg, var(--color-primary), var(--color-primary-light));
        }
        
        .kpi-card.green { 
            border-left-color: var(--color-success);
        }
        .kpi-card.green::before {
            background: linear-gradient(90deg, var(--color-success), #34D399);
        }
        
        .kpi-card.yellow { 
            border-left-color: #F59E0B;
        }
        .kpi-card.yellow::before {
            background: linear-gradient(90deg, #F59E0B, #FBBF24);
        }
        
        .kpi-card.purple { 
            border-left-color: #8B5CF6;
        }
        .kpi-card.purple::before {
            background: linear-gradient(90deg, #8B5CF6, #A78BFA);
        }
        
        /* Graphiques avec couleurs charte am√©lior√©es */
        .chart-container {
            background: linear-gradient(135deg, var(--color-background) 0%, #FAFBFC 100%);
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08), 0 2px 4px rgba(0, 0, 0, 0.04);
            border: 1px solid rgba(59, 130, 246, 0.1);
            transition: all 0.3s ease-in-out;
        }
        
        .chart-container:hover {
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12), 0 4px 8px rgba(0, 0, 0, 0.06);
            transform: translateY(-2px);
        }
        
        /* Sections avec espacement charte */
        .section-spacing {
            margin-bottom: 32px;
        }
        
        /* Titres selon charte am√©lior√©s */
        h2 {
            font-size: 28px;
            font-weight: 700;
            line-height: 1.2;
            color: var(--color-primary-dark);
            letter-spacing: -0.02em;
            margin-bottom: 8px;
        }
        
        h3 {
            font-size: 20px;
            font-weight: 600;
            line-height: 1.3;
            color: var(--color-primary-dark);
            letter-spacing: -0.01em;
        }
        
        /* Am√©lioration des tableaux */
        table {
            border-collapse: separate;
            border-spacing: 0;
        }
        
        table thead th {
            background: linear-gradient(135deg, #F0F4F8 0%, #E8F0F8 100%);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-size: 11px;
        }
        
        table tbody tr {
            transition: all 0.2s ease-in-out;
        }
        
        table tbody tr:hover {
            background: linear-gradient(90deg, #F8FAFC 0%, #F0F7FF 100%);
            transform: scale(1.01);
        }
        
        /* Am√©lioration des badges */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.02em;
            text-transform: uppercase;
        }
        
        /* Animations selon charte */
        .fade-in { 
            animation: fadeIn 0.5s ease-out forwards; 
            opacity: 0; 
            transform: translateY(10px); 
        }
        
        @keyframes fadeIn { 
            to { 
                opacity: 1; 
                transform: translateY(0); 
            } 
        }
        
        .delay-100 { animation-delay: 100ms; }
        .delay-200 { animation-delay: 200ms; }
        .delay-300 { animation-delay: 300ms; }
        .delay-400 { animation-delay: 400ms; }
        .delay-500 { animation-delay: 500ms; }
        
        /* Transitions selon charte (200-300ms, ease-in-out) */
        * {
            transition: all 0.2s ease-in-out;
        }
        
        /* Custom Scrollbar am√©lior√© */
        ::-webkit-scrollbar { 
            width: 8px; 
            height: 8px; 
        }
        ::-webkit-scrollbar-track { 
            background: #F1F5F9; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb { 
            background: linear-gradient(180deg, #CBD5E1, #94A3B8); 
            border-radius: 4px;
            border: 2px solid #F1F5F9;
        }
        ::-webkit-scrollbar-thumb:hover { 
            background: linear-gradient(180deg, #94A3B8, #64748B); 
        }
        
        /* Am√©lioration des badges de statut */
        .status-badge {
            padding: 6px 14px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        /* Am√©lioration des ic√¥nes dans les cartes */
        .kpi-icon {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease-in-out;
        }
        
        .kpi-card:hover .kpi-icon {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        /* Liens avec couleur charte */
        a {
            color: var(--color-primary);
        }
        
        a:hover {
            color: var(--color-primary-dark);
        }
        
        /* Am√©lioration de l'ergonomie */
        section {
            position: relative;
        }
        
        section::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--color-background-blue), transparent);
            opacity: 0.5;
        }
        
        section:first-of-type::before {
            display: none;
        }
        
        /* Am√©lioration de la navigation */
        nav a {
            min-height: 44px;
            display: inline-flex;
            align-items: center;
        }
        
        /* Menu desktop toujours visible sur √©crans moyens et grands */
        @media (min-width: 640px) {
            nav[aria-label="Menu de navigation"] {
                display: flex !important;
            }
        }
        
        /* Assurer que le menu desktop n'est pas cach√© sur les grands √©crans */
        @media (min-width: 640px) {
            nav[aria-label="Menu de navigation"].hidden {
                display: flex !important;
            }
        }
        
        /* Menu mobile am√©lior√© */
        #mobile-menu {
            animation: slideDown 0.3s ease-out;
        }
        
        #mobile-menu.hidden {
            display: none !important;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Am√©lioration de la visibilit√© du menu */
        nav[aria-label="Menu de navigation"] {
            align-items: center;
            justify-content: center;
        }
        
        nav[aria-label="Menu de navigation"] > div {
            display: flex;
            align-items: center;
            gap: 0;
        }
        
        nav[aria-label="Menu de navigation"] a {
            position: relative;
            white-space: nowrap;
            flex-shrink: 0;
            transition: all 0.2s ease;
        }
        
        nav[aria-label="Menu de navigation"] a:hover {
            transform: translateY(-1px);
        }
        
        nav[aria-label="Menu de navigation"] a.bg-primary-600 {
            box-shadow: 0 2px 4px rgba(37, 99, 235, 0.2);
        }
        
        /* Assurer la visibilit√© du menu sur tous les √©crans */
        @media (max-width: 767px) {
            nav[aria-label="Menu de navigation"] {
                display: none !important;
            }
        }
        
        /* Sur les √©crans moyens, ajuster l'espacement */
        @media (min-width: 768px) and (max-width: 1024px) {
            nav[aria-label="Menu de navigation"] > div {
                flex-wrap: wrap;
                gap: 2px;
            }
            nav[aria-label="Menu de navigation"] a {
                font-size: 0.75rem;
                padding: 0.375rem 0.5rem;
            }
            nav[aria-label="Menu de navigation"] a i {
                display: none;
            }
        }
        
        /* Am√©lioration des zones tactiles */
        button, .kpi-card, a[onclick] {
            min-height: 44px;
            touch-action: manipulation;
        }
        
        /* Am√©lioration du flux de lecture */
        main {
            max-width: 1400px;
        }
        
        /* Zones visuelles distinctes */
        .section-primary {
            background: linear-gradient(135deg, #FAFBFC 0%, #F8FAFC 100%);
            padding: 24px;
            border-radius: 16px;
            margin-bottom: 24px;
        }
        
        /* Am√©lioration de la hi√©rarchie */
        .kpi-section {
            background: var(--color-background);
            padding: 0;
            border-radius: 0;
        }
        
        .charts-section {
            background: transparent;
        }
    </style>
</head>
<body class="h-full flex flex-col">

    <!-- Navbar Moderne selon charte Pro Confiance -->
    <nav class="bg-white border-b-2 border-blue-100 sticky top-0 z-50 shadow-sm" role="navigation" aria-label="Navigation principale">
        <div class="max-w-[1920px] mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex-shrink-0 flex items-center cursor-pointer" onclick="window.location.href='dashboard.html'">
                    <div class="w-8 h-8 bg-primary-600 rounded-lg flex items-center justify-center text-white font-bold shadow-lg shadow-primary-500/30 mr-2">S</div>
                    <span class="text-xl font-bold text-gray-900 tracking-tight">Sily<span class="text-primary-600">Procure</span></span>
                </div>

                <!-- Menu de Navigation Centr√© -->
                <nav class="hidden md:flex items-center justify-center flex-1 mx-8" aria-label="Menu de navigation">
                    <div class="flex items-center space-x-1 bg-gray-50 rounded-lg p-1 border border-gray-200">
                        <a href="dashboard.html" class="inline-flex items-center px-3 py-2 rounded-md text-sm font-semibold min-h-[36px] transition-all bg-primary-600 text-white shadow-sm" aria-current="page">
                            <i class="fas fa-chart-line mr-2 text-xs" aria-hidden="true"></i>
                            <span>Dashboard</span>
                        </a>
                        <a href="rfq.html" class="inline-flex items-center px-3 py-2 rounded-md text-sm font-medium min-h-[36px] transition-all text-neutral-600 hover:text-primary-700 hover:bg-white">
                            <i class="fas fa-file-contract mr-2 text-xs" aria-hidden="true"></i>
                            <span>RFQ</span>
                        </a>
                        <a href="devis.html" class="inline-flex items-center px-3 py-2 rounded-md text-sm font-medium min-h-[36px] transition-all text-neutral-600 hover:text-primary-700 hover:bg-white">
                            <i class="fas fa-file-invoice-dollar mr-2 text-xs" aria-hidden="true"></i>
                            <span>Devis</span>
                        </a>
                        <a href="commandes.html" class="inline-flex items-center px-3 py-2 rounded-md text-sm font-medium min-h-[36px] transition-all text-neutral-600 hover:text-primary-700 hover:bg-white">
                            <i class="fas fa-shopping-cart mr-2 text-xs" aria-hidden="true"></i>
                            <span>Commandes</span>
                        </a>
                        <a href="entreprises.html" class="inline-flex items-center px-3 py-2 rounded-md text-sm font-medium min-h-[36px] transition-all text-neutral-600 hover:text-primary-700 hover:bg-white">
                            <i class="fas fa-building mr-2 text-xs" aria-hidden="true"></i>
                            <span>Entreprises</span>
                        </a>
                        <a href="factures.html" class="inline-flex items-center px-3 py-2 rounded-md text-sm font-medium min-h-[36px] transition-all text-neutral-600 hover:text-primary-700 hover:bg-white">
                            <i class="fas fa-money-bill-wave mr-2 text-xs" aria-hidden="true"></i>
                            <span>Factures</span>
                        </a>
                        <a href="carte.html" class="inline-flex items-center px-3 py-2 rounded-md text-sm font-medium min-h-[36px] transition-all text-neutral-600 hover:text-primary-700 hover:bg-white">
                            <i class="fas fa-map-marked-alt mr-2 text-xs" aria-hidden="true"></i>
                            <span>Carte</span>
                        </a>
                    </div>
                </nav>

                <!-- Actions Right Side -->
                <div class="flex items-center gap-3 flex-shrink-0">
                    <!-- Global Search (R√©duit) -->
                    <div class="hidden xl:block relative text-neutral-500 focus-within:text-primary-600" role="search">
                        <label for="global-search" class="sr-only">Rechercher</label>
                        <div class="pointer-events-none absolute inset-y-0 left-0 pl-3 flex items-center">
                            <i class="fas fa-search text-sm" aria-hidden="true"></i>
                        </div>
                        <input id="global-search" class="block w-48 bg-blue-50 py-2 pl-9 pr-3 border border-blue-200 rounded-lg leading-5 text-neutral-700 placeholder-neutral-400 focus:outline-none focus:bg-white focus:ring-2 focus:ring-primary-500 focus:border-primary-500 text-sm transition duration-150 ease-in-out h-9" placeholder="Rechercher..." type="search" aria-label="Rechercher">
                    </div>

                    <!-- Notifications -->
                    <button class="relative p-2 text-neutral-500 hover:text-primary-600 transition-colors rounded-lg hover:bg-blue-50 min-w-[36px] min-h-[36px] flex items-center justify-center" aria-label="Notifications" title="Notifications">
                        <i class="far fa-bell text-lg" aria-hidden="true"></i>
                        <span class="absolute top-1.5 right-1.5 block h-2 w-2 rounded-full bg-red-500 ring-2 ring-white" aria-hidden="true"></span>
                    </button>

                    <!-- Profile -->
                    <div class="relative flex items-center gap-2">
                        <div class="h-9 w-9 rounded-full bg-primary-100 flex items-center justify-center text-primary-700 font-bold border-2 border-primary-200 shadow-sm" aria-label="Profil utilisateur">
                            <span id="user-initials" class="text-xs">U</span>
                        </div>
                        <span id="user-name" class="hidden lg:block text-sm font-semibold text-neutral-700 max-w-[100px] truncate">Chargement...</span>
                        <button onclick="logout()" class="p-2 text-gray-400 hover:text-red-500 transition-colors rounded-lg hover:bg-red-50" title="D√©connexion" aria-label="D√©connexion">
                            <i class="fas fa-power-off text-sm"></i>
                        </button>
                    </div>
                    
                    <!-- Menu mobile -->
                    <div class="md:hidden ml-1">
                        <button id="mobile-menu-button" onclick="toggleMobileMenu()" class="inline-flex items-center justify-center p-2 rounded-lg text-neutral-500 hover:text-primary-600 hover:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary-500 min-w-[36px] min-h-[36px]" aria-expanded="false" aria-label="Menu principal" aria-controls="mobile-menu">
                            <i class="fas fa-bars text-lg"></i>
                        </button>
                    </div>
                </div>
            </div>
            <!-- Menu mobile d√©roulant -->
            <div id="mobile-menu" class="hidden md:hidden border-t-2 border-blue-100 bg-white shadow-lg">
                <div class="px-4 pt-3 pb-4 space-y-1">
                    <a href="dashboard.html" class="bg-gradient-to-r from-blue-50 to-primary-50 border-l-4 border-primary-500 text-primary-700 block px-4 py-3 rounded-lg text-base font-semibold min-h-[44px] flex items-center gap-3 transition-all">
                        <i class="fas fa-chart-line text-primary-600" aria-hidden="true"></i>
                        <span>Dashboard</span>
                    </a>
                    <a href="rfq.html" class="border-transparent text-neutral-700 hover:bg-blue-50 hover:text-primary-700 hover:border-l-4 hover:border-primary-300 block px-4 py-3 rounded-lg text-base font-medium transition-all min-h-[44px] flex items-center gap-3">
                        <i class="fas fa-file-contract text-neutral-500" aria-hidden="true"></i>
                        <span>RFQ</span>
                    </a>
                    <a href="devis.html" class="border-transparent text-neutral-700 hover:bg-blue-50 hover:text-primary-700 hover:border-l-4 hover:border-primary-300 block px-4 py-3 rounded-lg text-base font-medium transition-all min-h-[44px] flex items-center gap-3">
                        <i class="fas fa-file-invoice-dollar text-neutral-500" aria-hidden="true"></i>
                        <span>Devis</span>
                    </a>
                    <a href="commandes.html" class="border-transparent text-neutral-700 hover:bg-blue-50 hover:text-primary-700 hover:border-l-4 hover:border-primary-300 block px-4 py-3 rounded-lg text-base font-medium transition-all min-h-[44px] flex items-center gap-3">
                        <i class="fas fa-shopping-cart text-neutral-500" aria-hidden="true"></i>
                        <span>Commandes</span>
                    </a>
                    <a href="entreprises.html" class="border-transparent text-neutral-700 hover:bg-blue-50 hover:text-primary-700 hover:border-l-4 hover:border-primary-300 block px-4 py-3 rounded-lg text-base font-medium transition-all min-h-[44px] flex items-center gap-3">
                        <i class="fas fa-building text-neutral-500" aria-hidden="true"></i>
                        <span>Entreprises</span>
                    </a>
                    <a href="factures.html" class="border-transparent text-neutral-700 hover:bg-blue-50 hover:text-primary-700 hover:border-l-4 hover:border-primary-300 block px-4 py-3 rounded-lg text-base font-medium transition-all min-h-[44px] flex items-center gap-3">
                        <i class="fas fa-money-bill-wave text-neutral-500" aria-hidden="true"></i>
                        <span>Factures</span>
                    </a>
                    <a href="carte.html" class="border-transparent text-neutral-700 hover:bg-blue-50 hover:text-primary-700 hover:border-l-4 hover:border-primary-300 block px-4 py-3 rounded-lg text-base font-medium transition-all min-h-[44px] flex items-center gap-3">
                        <i class="fas fa-map-marked-alt text-neutral-500" aria-hidden="true"></i>
                        <span>Carte</span>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-1 max-w-7xl w-full mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Header & Quick Actions -->
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6 mb-8 border-b border-blue-100 pb-6">
            <div>
                <h2 class="text-3xl font-bold leading-tight text-primary-900 sm:text-4xl">
                    Tableau de bord
                </h2>
                <p class="mt-2 text-base text-neutral-600 font-medium">
                    Bienvenue, voici un aper√ßu complet de vos activit√©s d'achat
                </p>
            </div>
            
            <!-- Quick Actions Toolbar -->
            <div class="flex flex-wrap gap-3">
                <button onclick="window.location.href='rfq-create.html'" class="inline-flex items-center px-5 py-2.5 border border-transparent shadow-lg text-sm font-semibold rounded-xl text-white bg-gradient-to-r from-primary-500 to-primary-600 hover:from-primary-600 hover:to-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all transform hover:scale-105 hover:shadow-xl">
                    <i class="fas fa-plus mr-2"></i> Nouvelle RFQ
                </button>
                <button onclick="window.location.href='entreprises.html'" class="inline-flex items-center px-5 py-2.5 border-2 border-primary-200 shadow-sm text-sm font-semibold rounded-xl text-primary-700 bg-white hover:bg-gradient-to-r hover:from-blue-50 hover:to-primary-50 hover:border-primary-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all">
                    <i class="fas fa-user-plus mr-2 text-primary-500"></i> Fournisseur
                </button>
                <button onclick="refreshDashboard()" class="inline-flex items-center justify-center p-2.5 border-2 border-primary-200 shadow-sm text-sm font-semibold rounded-xl text-primary-700 bg-white hover:bg-gradient-to-r hover:from-blue-50 hover:to-primary-50 hover:border-primary-300 focus:outline-none transition-all" title="Actualiser">
                    <i class="fas fa-sync-alt text-primary-500"></i>
                </button>
            </div>
        </div>

        <!-- KPI Cards - Zone Principale -->
        <section class="kpi-section mb-10">
            <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4">
            
            <!-- Commandes -->
            <div class="kpi-card blue bg-white overflow-hidden rounded-2xl border border-blue-100 cursor-pointer fade-in delay-100" onclick="window.location.href='commandes.html'">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-5">
                        <div class="flex items-center gap-3">
                            <div class="p-3 bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl shadow-sm kpi-icon">
                                <i class="fas fa-shopping-cart text-primary-600 text-xl"></i>
                            </div>
                            <span class="text-sm font-semibold text-neutral-600 uppercase tracking-wide">Commandes</span>
                        </div>
                        <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-bold bg-gradient-to-r from-green-100 to-emerald-100 text-green-700 border border-green-200">
                            +12%
                        </span>
                    </div>
                    <div class="flex items-baseline gap-2">
                        <span class="text-3xl font-bold text-primary-900" id="stats-cmd-count">-</span>
                        <span class="text-sm font-medium text-neutral-500 ml-1">totales</span>
                    </div>
                </div>
            </div>

            <!-- D√©penses & Budget -->
            <div class="kpi-card green bg-white overflow-hidden rounded-2xl border border-blue-100 fade-in delay-200">
                <div class="p-6">
                    <div class="flex items-center gap-3 mb-4">
                            <div class="p-3 bg-gradient-to-br from-green-50 to-emerald-100 rounded-xl shadow-sm kpi-icon">
                                <i class="fas fa-money-bill-wave text-success-600 text-xl"></i>
                            </div>
                        <span class="text-sm font-semibold text-neutral-600 uppercase tracking-wide">D√©penses (Mois)</span>
                    </div>
                    <div class="mt-2">
                        <span class="text-3xl font-bold text-primary-900 block mb-4" id="stats-amount">-</span>
                        <!-- Budget Bar -->
                        <div class="mt-4 relative">
                            <div class="flex mb-2 items-center justify-between">
                                <div class="text-right w-full">
                                    <span class="text-xs font-bold inline-block text-success-600" id="budget-percent">
                                        75% du budget
                                    </span>
                                </div>
                            </div>
                            <div class="overflow-hidden h-2.5 mb-1 text-xs flex rounded-full bg-green-100 shadow-inner">
                                <div style="width: 75%" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-gradient-to-r from-success-500 to-emerald-500 rounded-full"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RFQ -->
            <div class="kpi-card yellow bg-white overflow-hidden rounded-2xl border border-blue-100 cursor-pointer fade-in delay-300" onclick="window.location.href='rfq.html'">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-5">
                        <div class="flex items-center gap-3">
                            <div class="p-3 bg-gradient-to-br from-yellow-50 to-amber-100 rounded-xl shadow-sm kpi-icon">
                                <i class="fas fa-file-contract text-yellow-600 text-xl"></i>
                            </div>
                            <span class="text-sm font-semibold text-neutral-600 uppercase tracking-wide">Appels d'offres</span>
                        </div>
                        <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-bold bg-gradient-to-r from-yellow-100 to-amber-100 text-yellow-700 border border-yellow-200">
                            Actif
                        </span>
                    </div>
                    <div class="flex items-baseline gap-2">
                        <span class="text-3xl font-bold text-primary-900" id="stats-rfq-count">-</span>
                        <span class="text-sm font-medium text-neutral-500 ml-1">en cours</span>
                    </div>
                </div>
            </div>

            <!-- Fournisseurs -->
            <div class="kpi-card purple bg-white overflow-hidden rounded-2xl border border-blue-100 cursor-pointer fade-in delay-400" onclick="window.location.href='entreprises.html'">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-5">
                        <div class="flex items-center gap-3">
                            <div class="p-3 bg-gradient-to-br from-purple-50 to-violet-100 rounded-xl shadow-sm kpi-icon">
                                <i class="fas fa-building text-purple-600 text-xl"></i>
                            </div>
                            <span class="text-sm font-semibold text-neutral-600 uppercase tracking-wide">Fournisseurs</span>
                        </div>
                    </div>
                    <div class="flex items-baseline gap-2">
                        <span class="text-3xl font-bold text-primary-900" id="stats-supplier-count">-</span>
                        <span class="text-sm font-medium text-neutral-500 ml-1">actifs</span>
                    </div>
                </div>
            </div>
            </div>
        </section>

        <!-- Charts Grid 1: Finances & RFQ - Graphiques Principaux -->
        <section class="charts-section mb-10">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Main Chart: Evolution des achats -->
            <div class="chart-container bg-white rounded-2xl p-8 lg:col-span-2 fade-in">
                <div class="flex items-center justify-between mb-8">
                    <div>
                        <h3 class="text-xl font-bold text-primary-900 mb-1">√âvolution des Achats</h3>
                        <p class="text-sm text-neutral-500">6 derniers mois</p>
                    </div>
                    <div class="flex gap-2">
                        <span class="inline-flex items-center px-3 py-1.5 rounded-full text-xs font-semibold bg-gradient-to-r from-blue-100 to-primary-100 text-primary-800 border border-primary-200">
                            <span class="w-2.5 h-2.5 bg-primary-500 rounded-full mr-2 shadow-sm"></span>
                            Commandes
                        </span>
                    </div>
                </div>
                <div class="relative h-80 w-full">
                    <canvas id="mainChart"></canvas>
                </div>
            </div>

            <!-- Doughnut Chart: RFQ Statut -->
            <div class="chart-container bg-white rounded-2xl p-8 fade-in flex flex-col">
                <div class="mb-6">
                    <h3 class="text-xl font-bold text-primary-900 mb-1">Statut des RFQ</h3>
                    <p class="text-sm text-neutral-500">R√©partition</p>
                </div>
                <div class="relative flex-1 flex items-center justify-center min-h-[320px]">
                    <canvas id="rfqChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Charts Grid 2: Categories & Secteurs - Graphiques Secondaires -->
        <section class="charts-section mb-10">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 fade-in delay-500">
            
            <!-- Bar Chart: Cat√©gories -->
            <div class="chart-container bg-white rounded-2xl p-8">
                <div class="mb-6">
                    <h3 class="text-xl font-bold text-primary-900 mb-1">Cat√©gories les plus demand√©es</h3>
                    <p class="text-sm text-neutral-500">Top 5</p>
                </div>
                <div class="relative h-80 w-full">
                    <canvas id="categoriesChart"></canvas>
                </div>
            </div>

            <!-- Polar Area Chart: Secteurs -->
            <div class="chart-container bg-white rounded-2xl p-8">
                <div class="mb-6">
                    <h3 class="text-xl font-bold text-primary-900 mb-1">Secteurs les plus sollicit√©s</h3>
                    <p class="text-sm text-neutral-500">Top 5</p>
                </div>
                <div class="relative h-80 w-full flex justify-center">
                    <canvas id="sectorsChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Recent Activity & Notifications - Activit√© R√©cente -->
        <section class="charts-section mb-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- Derni√®res Commandes (Tableau Am√©lior√©) -->
            <div class="bg-white shadow-lg rounded-2xl overflow-hidden fade-in border border-blue-100">
                <div class="px-8 py-6 border-b-2 border-blue-100 bg-gradient-to-r from-blue-50 to-primary-50 flex justify-between items-center">
                    <div>
                        <h3 class="text-xl font-bold text-primary-900 mb-1">Commandes R√©centes</h3>
                        <p class="text-xs text-neutral-500">5 derni√®res commandes</p>
                    </div>
                    <a href="commandes.html" class="text-sm font-semibold text-primary-600 hover:text-primary-900 transition-colors flex items-center gap-1">
                        Tout voir <i class="fas fa-arrow-right text-xs"></i>
                    </a>
                </div>
                <div class="table-container">
                    <table class="table min-w-full divide-y divide-blue-100">
                        <thead>
                            <tr>
                                <th scope="col" class="px-6 py-4 text-left text-xs font-bold text-primary-900 uppercase tracking-wider">R√©f</th>
                                <th scope="col" class="px-6 py-4 text-left text-xs font-bold text-primary-900 uppercase tracking-wider">Fournisseur</th>
                                <th scope="col" class="px-6 py-4 text-right text-xs font-bold text-primary-900 uppercase tracking-wider">Montant</th>
                                <th scope="col" class="px-6 py-4 text-center text-xs font-bold text-primary-900 uppercase tracking-wider">Statut</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-blue-100" id="recent-orders-tbody">
                            <!-- JS Injection -->
                            <tr><td colspan="4" class="px-6 py-8 text-center text-sm text-neutral-500">Chargement...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Messages -->
            <div class="bg-white shadow-lg rounded-2xl overflow-hidden fade-in border border-blue-100">
                <div class="px-8 py-6 border-b-2 border-blue-100 bg-gradient-to-r from-blue-50 to-primary-50 flex justify-between items-center">
                    <div>
                        <h3 class="text-xl font-bold text-primary-900 mb-1">Derniers Messages</h3>
                        <p class="text-xs text-neutral-500">Messages de contact</p>
                    </div>
                    <span class="inline-flex items-center px-3 py-1.5 rounded-full text-xs font-bold bg-gradient-to-r from-red-100 to-pink-100 text-red-700 border border-red-200" id="unread-count">0</span>
                </div>
                <ul class="divide-y divide-blue-100 overflow-y-auto max-h-[400px]" id="messages-list">
                    <li class="p-8 text-center text-neutral-500 text-sm">Aucun message</li>
                </ul>
            </div>

        </section>

    </main>

    <script src="js/auth.js"></script>
    <script src="js/app.js"></script>
    <script>
        // ==========================================
        // UTILITAIRES
        // ==========================================

        // V√©rifier l'authentification
        checkAuth();

        // Toast est d√©fini dans components.js, on utilise celui-l√†
        // Si Toast n'existe pas, cr√©er une version de fallback
        if (typeof Toast === 'undefined') {
            window.Toast = {
                success: (msg) => alert('‚úÖ ' + msg),
                error: (msg) => alert('‚ùå ' + msg),
                info: (msg) => alert('‚ÑπÔ∏è ' + msg),
                warning: (msg) => alert('‚ö†Ô∏è ' + msg)
            };
        }

        // formatCurrency est d√©j√† d√©fini dans app.js, mais on peut le red√©finir si n√©cessaire
        if (typeof formatCurrency === 'undefined') {
            function formatCurrency(val) {
                if (!val && val !== 0) return '0 GNF';
                return new Intl.NumberFormat('fr-FR', { 
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                }).format(val) + ' GNF';
            }
        }

        // ==========================================
        // LOGIQUE PRINCIPALE
        // ==========================================

        const user = JSON.parse(localStorage.getItem('user') || '{}');
        const userNameEl = document.getElementById('user-name');
        const userInitialsEl = document.getElementById('user-initials');
        
        if (userNameEl) {
            userNameEl.textContent = `${user.prenom || ''} ${user.nom || ''}`.trim() || user.email || 'Utilisateur';
        }
        if (userInitialsEl) {
            userInitialsEl.textContent = (user.prenom || user.nom || 'U').charAt(0).toUpperCase();
        }

        async function initDashboard() {
            try {
                console.log('üîÑ Initialisation du dashboard...');
                
                // V√©rifier l'authentification
                const token = localStorage.getItem('token');
                if (!token) {
                    console.error('‚ùå Aucun token trouv√©, redirection vers login');
                    Toast.error('Veuillez vous connecter');
                    setTimeout(() => window.location.href = 'index.html', 2000);
                    return;
                }
                
                console.log('üì° Appel API /api/dashboard/stats...');
                const statsRes = await apiCall('/api/dashboard/stats');
                
                if (!statsRes) {
                    console.error('‚ùå apiCall a retourn√© null (probablement 401)');
                    Toast.error('Session expir√©e. Redirection...');
                    setTimeout(() => window.location.href = 'index.html', 2000);
                    return;
                }
                
                if (!statsRes.ok) {
                    const errorText = await statsRes.text().catch(() => 'Erreur inconnue');
                    console.error('‚ùå Erreur API stats:', {
                        status: statsRes.status,
                        statusText: statsRes.statusText,
                        error: errorText
                    });
                    
                    if (statsRes.status === 401) {
                        Toast.error('Session expir√©e. Redirection...');
                        setTimeout(() => window.location.href = 'index.html', 2000);
                    } else if (statsRes.status === 500) {
                        Toast.error('Erreur serveur. V√©rifiez les logs du backend.');
                    } else {
                        Toast.error(`Erreur ${statsRes.status}: Impossible de charger les statistiques`);
                    }
                    return;
                }
                
                console.log('‚úÖ R√©ponse API re√ßue, parsing JSON...');
                const stats = await statsRes.json();
                console.log('üìä Statistiques re√ßues:', stats);
                
                // Update KPI Cards
                const cmdCountEl = document.getElementById('stats-cmd-count');
                const amountEl = document.getElementById('stats-amount');
                const rfqCountEl = document.getElementById('stats-rfq-count');
                const supplierCountEl = document.getElementById('stats-supplier-count');
                
                if (!cmdCountEl || !amountEl || !rfqCountEl || !supplierCountEl) {
                    console.error('‚ùå √âl√©ments DOM manquants pour les KPIs');
                    Toast.error('Erreur: √©l√©ments de la page introuvables');
                    return;
                }
                
                console.log('üìù Mise √† jour des KPIs...');
                cmdCountEl.innerText = stats.commandes_total || 0;
                amountEl.innerText = formatCurrency(stats.montant_mois || 0);
                rfqCountEl.innerText = stats.rfq_en_cours || 0;
                supplierCountEl.innerText = stats.fournisseurs_actifs || 0;
                console.log('‚úÖ KPIs mis √† jour');

                // Init Charts
                console.log('üìä Initialisation des graphiques...');
                initCharts(stats);

                // Load Lists
                console.log('üìã Chargement des listes...');
                loadRecentOrders();
                loadMessages();
                
                console.log('‚úÖ Dashboard initialis√© avec succ√®s');

            } catch (error) {
                console.error('‚ùå Erreur initDashboard:', error);
                console.error('Stack:', error.stack);
                Toast.error('Erreur initialisation dashboard: ' + (error.message || 'Erreur inconnue'));
            }
        }

        // Variables pour stocker les instances de graphiques
        let mainChartInstance = null;
        let rfqChartInstance = null;
        let categoriesChartInstance = null;
        let sectorsChartInstance = null;

        function destroyCharts() {
            // D√©truire les graphiques existants
            if (mainChartInstance) {
                mainChartInstance.destroy();
                mainChartInstance = null;
            }
            if (rfqChartInstance) {
                rfqChartInstance.destroy();
                rfqChartInstance = null;
            }
            if (categoriesChartInstance) {
                categoriesChartInstance.destroy();
                categoriesChartInstance = null;
            }
            if (sectorsChartInstance) {
                sectorsChartInstance.destroy();
                sectorsChartInstance = null;
            }
        }

        function initCharts(stats) {
            // D√©truire les graphiques existants avant d'en cr√©er de nouveaux
            destroyCharts();
            
            // Main Line Chart (Achats)
            const ctxMain = document.getElementById('mainChart');
            if (!ctxMain) return;
            
            const ctx = ctxMain.getContext('2d');
            
            // G√©rer les cas o√π evolution_commandes peut √™tre vide ou undefined
            const evolutionData = stats.evolution_commandes || [];
            const months = evolutionData.map(d => {
                if (!d || !d.mois) return '';
                const date = new Date(d.mois + '-01');
                if (isNaN(date.getTime())) return d.mois;
                return date.toLocaleDateString('fr-FR', { month: 'short', year: '2-digit' });
            }).filter(m => m !== '');
            const amounts = evolutionData.map(d => parseFloat(d.montant || 0));

            // Gradient Fill
            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(37, 99, 235, 0.2)');
            gradient.addColorStop(1, 'rgba(37, 99, 235, 0.0)');

            mainChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Montant Achats (GNF)',
                        data: amounts,
                        borderColor: '#3B82F6',
                        backgroundColor: gradient,
                        fill: true,
                        tension: 0.5,
                        borderWidth: 3,
                        pointRadius: 5,
                        pointHoverRadius: 7,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#3B82F6',
                        pointBorderWidth: 2,
                        pointHoverBackgroundColor: '#3B82F6',
                        pointHoverBorderColor: '#fff',
                        pointHoverBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(30, 58, 138, 0.95)',
                            padding: 16,
                            cornerRadius: 12,
                            titleFont: { family: 'Inter', size: 14, weight: '600' },
                            bodyFont: { family: 'Inter', size: 13, weight: '500' },
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderColor: '#3B82F6',
                            borderWidth: 1,
                            displayColors: false,
                            callbacks: {
                                label: function(context) {
                                    return new Intl.NumberFormat('fr-FR', {
                                        style: 'currency',
                                        currency: 'XOF',
                                        maximumFractionDigits: 0
                                    }).format(context.parsed.y);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { 
                                borderDash: [4, 4], 
                                color: 'rgba(59, 130, 246, 0.1)',
                                drawBorder: false
                            },
                            ticks: { 
                                callback: (value) => (value / 1000000) + 'M', 
                                font: { family: 'Inter', size: 12, weight: '500' },
                                color: '#64748B',
                                padding: 10
                            }
                        },
                        x: {
                            grid: { display: false, drawBorder: false },
                            ticks: { 
                                font: { family: 'Inter', size: 12, weight: '500' },
                                color: '#64748B',
                                padding: 10
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });

            // RFQ Doughnut
            const ctxRfq = document.getElementById('rfqChart');
            if (ctxRfq) {
                const rfqCtx = ctxRfq.getContext('2d');
                const rfqParStatut = stats.rfq_par_statut || [];
                const rfqData = rfqParStatut.map(s => parseInt(s.nombre || 0));
                const rfqLabels = rfqParStatut.map(s => {
                    const statut = s.statut || '';
                    return statut.charAt(0).toUpperCase() + statut.slice(1).replace('_', ' ');
                });
                const rfqColors = ['#cbd5e1', '#3b82f6', '#10b981', '#ef4444', '#f59e0b'];

                rfqChartInstance = new Chart(rfqCtx, {
                    type: 'doughnut',
                    data: {
                        labels: rfqLabels,
                        datasets: [{
                            data: rfqData,
                            backgroundColor: [
                                '#E0E7FF',
                                '#3B82F6',
                                '#10B981',
                                '#F59E0B',
                                '#EF4444'
                            ],
                            borderWidth: 3,
                            borderColor: '#fff',
                            hoverOffset: 15,
                            hoverBorderWidth: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '65%',
                        plugins: {
                            legend: { 
                                position: 'bottom', 
                                labels: { 
                                    usePointStyle: true, 
                                    pointStyle: 'circle',
                                    padding: 15,
                                    font: { family: 'Inter', size: 12, weight: '500' },
                                    color: '#475569'
                                } 
                            },
                            tooltip: {
                                backgroundColor: 'rgba(30, 58, 138, 0.95)',
                                padding: 12,
                                cornerRadius: 8,
                                titleFont: { family: 'Inter', size: 13, weight: '600' },
                                bodyFont: { family: 'Inter', size: 12, weight: '500' },
                                titleColor: '#fff',
                                bodyColor: '#fff',
                                borderColor: '#3B82F6',
                                borderWidth: 1
                            }
                        }
                    }
                });
            }

            // Categories Bar Chart - Utiliser les donn√©es r√©elles de la base de donn√©es
            const ctxCat = document.getElementById('categoriesChart');
            if (ctxCat) {
                if (stats.top_categories && stats.top_categories.length > 0) {
                    const catCtx = ctxCat.getContext('2d');
                    const catLabels = stats.top_categories.map(c => c.nom || 'Autre');
                    const catData = stats.top_categories.map(c => parseInt(c.valeur || 0));

                    categoriesChartInstance = new Chart(catCtx, {
                        type: 'bar',
                        data: {
                            labels: catLabels,
                            datasets: [{
                                label: 'Demandes',
                                data: catData,
                                backgroundColor: 'rgba(59, 130, 246, 0.8)',
                                hoverBackgroundColor: '#3B82F6',
                                borderRadius: 8,
                                borderSkipped: false,
                                barThickness: 35,
                                maxBarThickness: 50
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { 
                                legend: { display: false },
                                tooltip: {
                                    backgroundColor: 'rgba(30, 58, 138, 0.95)',
                                    padding: 12,
                                    cornerRadius: 8,
                                    titleFont: { family: 'Inter', size: 13, weight: '600' },
                                    bodyFont: { family: 'Inter', size: 12, weight: '500' },
                                    titleColor: '#fff',
                                    bodyColor: '#fff',
                                    borderColor: '#3B82F6',
                                    borderWidth: 1
                                }
                            },
                            scales: {
                                y: { 
                                    beginAtZero: true, 
                                    grid: { 
                                        borderDash: [4, 4], 
                                        color: 'rgba(59, 130, 246, 0.1)',
                                        drawBorder: false
                                    },
                                    ticks: {
                                        font: { family: 'Inter', size: 12, weight: '500' },
                                        color: '#64748B',
                                        padding: 10
                                    }
                                },
                                x: { 
                                    grid: { display: false, drawBorder: false },
                                    ticks: {
                                        font: { family: 'Inter', size: 12, weight: '500' },
                                        color: '#64748B',
                                        padding: 10
                                    }
                                }
                            }
                        }
                    });
                } else {
                    // Afficher un message si pas de donn√©es
                    ctxCat.parentElement.innerHTML = `
                        <div class="flex items-center justify-center h-72 text-neutral-500">
                            <div class="text-center">
                                <i class="fas fa-chart-bar text-4xl mb-2 opacity-50"></i>
                                <p>Aucune donn√©e de cat√©gories disponible</p>
                            </div>
                        </div>
                    `;
                }
            }

            // Sectors Polar Area Chart - Utiliser les donn√©es r√©elles de la base de donn√©es
            const ctxSect = document.getElementById('sectorsChart');
            if (ctxSect) {
                if (stats.top_secteurs && stats.top_secteurs.length > 0) {
                    const sectCtx = ctxSect.getContext('2d');
                    const sectLabels = stats.top_secteurs.map(s => s.nom || 'Autre');
                    const sectData = stats.top_secteurs.map(s => parseInt(s.valeur || 0));
                    const sectColors = ['#3b82f6', '#6366f1', '#8b5cf6', '#a855f7', '#d946ef'];

                    sectorsChartInstance = new Chart(sectCtx, {
                        type: 'polarArea',
                        data: {
                            labels: sectLabels,
                            datasets: [{
                                data: sectData,
                                backgroundColor: [
                                    'rgba(59, 130, 246, 0.7)',
                                    'rgba(99, 102, 241, 0.7)',
                                    'rgba(139, 92, 246, 0.7)',
                                    'rgba(168, 85, 247, 0.7)',
                                    'rgba(217, 70, 239, 0.7)'
                                ].slice(0, sectData.length),
                                borderColor: '#fff',
                                borderWidth: 3,
                                hoverBorderWidth: 4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { 
                                    position: 'right', 
                                    labels: { 
                                        usePointStyle: true,
                                        padding: 15,
                                        font: { family: 'Inter', size: 12, weight: '500' },
                                        color: '#475569'
                                    } 
                                },
                                tooltip: {
                                    backgroundColor: 'rgba(30, 58, 138, 0.95)',
                                    padding: 12,
                                    cornerRadius: 8,
                                    titleFont: { family: 'Inter', size: 13, weight: '600' },
                                    bodyFont: { family: 'Inter', size: 12, weight: '500' },
                                    titleColor: '#fff',
                                    bodyColor: '#fff',
                                    borderColor: '#3B82F6',
                                    borderWidth: 1
                                }
                            },
                            scales: {
                                r: { 
                                    ticks: { display: false },
                                    grid: { 
                                        color: 'rgba(59, 130, 246, 0.1)',
                                        lineWidth: 1
                                    },
                                    pointLabels: {
                                        font: { family: 'Inter', size: 11, weight: '500' },
                                        color: '#64748B'
                                    }
                                }
                            }
                        }
                    });
                } else {
                    // Afficher un message si pas de donn√©es
                    ctxSect.parentElement.innerHTML = `
                        <div class="flex items-center justify-center h-72 text-neutral-500">
                            <div class="text-center">
                                <i class="fas fa-chart-pie text-4xl mb-2 opacity-50"></i>
                                <p>Aucune donn√©e de secteurs disponible</p>
                            </div>
                        </div>
                    `;
                }
            }
        }

        async function loadRecentOrders() {
            try {
                console.log('üì¶ Chargement des commandes r√©centes...');
                const res = await apiCall('/api/commandes?limit=5');
                
                if (!res) {
                    console.error('‚ùå apiCall a retourn√© null pour les commandes');
                    const list = document.getElementById('recent-orders-tbody');
                    if (list) {
                        list.innerHTML = '<tr><td colspan="4" class="px-6 py-4 text-center text-sm text-red-500">Erreur d\'authentification</td></tr>';
                    }
                    return;
                }
                
                if (!res.ok) {
                    console.error('‚ùå Erreur API commandes:', res.status, res.statusText);
                    const list = document.getElementById('recent-orders-tbody');
                    if (list) {
                        list.innerHTML = `<tr><td colspan="4" class="px-6 py-4 text-center text-sm text-red-500">Erreur ${res.status}</td></tr>`;
                    }
                    return;
                }
                
                const orders = await res.json();
                console.log('üì¶ Commandes re√ßues:', orders?.length || 0);
                const list = document.getElementById('recent-orders-tbody');
                
                if (!list) {
                    console.error('‚ùå √âl√©ment recent-orders-tbody introuvable');
                    return;
                }
                
                if (!orders || orders.length === 0) {
                    console.log('‚ÑπÔ∏è Aucune commande √† afficher');
                    list.innerHTML = '<tr><td colspan="4" class="px-6 py-4 text-center text-sm text-neutral-500">Aucune commande</td></tr>';
                    return;
                }

                list.innerHTML = orders.map(o => `
                    <tr class="hover:bg-blue-50 cursor-pointer transition" onclick="window.location.href='commandes-detail.html?id=${o.id}'">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-primary-600">${o.numero}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-primary-900">
                            <div class="flex items-center">
                                <div class="h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center text-primary-600 font-bold mr-3 text-xs">
                                    ${o.fournisseur_nom.charAt(0)}
                                </div>
                                ${o.fournisseur_nom}
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-right text-neutral-600 font-medium">${formatCurrency(o.total_ttc)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-center">
                            <span class="status-badge ${o.statut === 'livre' ? 'bg-gradient-to-r from-green-100 to-emerald-100 text-green-700 border border-green-200' : 'bg-gradient-to-r from-blue-100 to-primary-100 text-primary-700 border border-primary-200'}">
                                ${o.statut}
                            </span>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Erreur loadRecentOrders:', error);
            }
        }

        async function loadMessages() {
            try {
                console.log('üí¨ Chargement des messages...');
                const res = await apiCall('/api/contact/messages?limit=10');
                
                if (!res) {
                    console.error('‚ùå apiCall a retourn√© null pour les messages');
                    const list = document.getElementById('messages-list');
                    if (list) {
                        list.innerHTML = '<li class="p-6 text-center text-red-500 text-sm">Erreur d\'authentification</li>';
                    }
                    return;
                }
                
                if (!res.ok) {
                    console.error('‚ùå Erreur API messages:', res.status, res.statusText);
                    const list = document.getElementById('messages-list');
                    if (list) {
                        list.innerHTML = `<li class="p-6 text-center text-red-500 text-sm">Erreur ${res.status}</li>`;
                    }
                    return;
                }
                
                const data = await res.json();
                const messages = data.data || data || [];
                console.log('üí¨ Messages re√ßus:', messages.length);
                const list = document.getElementById('messages-list');
                const badge = document.getElementById('unread-count');
                
                if (!list) {
                    console.error('‚ùå √âl√©ment messages-list introuvable');
                    return;
                }
                
                const unreadCount = messages.filter(m => !m.lu).length;
                if (badge) {
                    badge.innerText = `${unreadCount} nouveaux`;
                    badge.className = `inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${unreadCount > 0 ? 'bg-red-100 text-red-800' : 'bg-gray-100 text-gray-800'}`;
                }

                if (messages.length === 0) {
                    list.innerHTML = '<li class="p-6 text-center text-neutral-500 text-sm">Aucun message</li>';
                    return;
                }

                list.innerHTML = messages.map(m => `
                    <li class="px-6 py-4 hover:bg-blue-50 transition cursor-pointer border-b border-blue-100 last:border-0 ${!m.lu ? 'bg-blue-50/50' : ''}">
                        <div class="flex items-start space-x-3">
                            <div class="flex-shrink-0">
                                <div class="h-8 w-8 rounded-full bg-primary-100 flex items-center justify-center text-primary-600 font-bold text-xs">
                                    ${m.nom.charAt(0)}
                                </div>
                            </div>
                            <div class="min-w-0 flex-1">
                                <p class="text-sm font-medium text-primary-900 flex justify-between">
                                    <span>${m.sujet}</span>
                                    <span class="text-xs text-neutral-400 font-normal">${new Date(m.date_creation).toLocaleDateString()}</span>
                                </p>
                                <p class="text-sm text-neutral-500 truncate">${m.message}</p>
                            </div>
                        </div>
                    </li>
                `).join('');
            } catch (error) {
                console.error('Erreur loadMessages:', error);
            }
        }

        function refreshDashboard() {
            Toast.info('Actualisation...');
            initDashboard();
        }

        window.refreshDashboard = refreshDashboard;

        // Menu mobile
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const button = document.getElementById('mobile-menu-button');
            if (menu && button) {
                const isHidden = menu.classList.contains('hidden');
                menu.classList.toggle('hidden');
                
                // Mettre √† jour l'√©tat ARIA
                button.setAttribute('aria-expanded', isHidden ? 'true' : 'false');
                
                // Changer l'ic√¥ne
                const icon = button.querySelector('i');
                if (icon) {
                    if (isHidden) {
                        icon.classList.remove('fa-bars');
                        icon.classList.add('fa-times');
                    } else {
                        icon.classList.remove('fa-times');
                        icon.classList.add('fa-bars');
                    }
                }
            }
        }
        window.toggleMobileMenu = toggleMobileMenu;

        // Attendre que le DOM soit charg√©
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                console.log('üìÑ DOM charg√©, initialisation du dashboard...');
                initDashboard();
            });
        } else {
            console.log('üìÑ DOM d√©j√† charg√©, initialisation imm√©diate...');
            initDashboard();
        }
    </script>
</body>
</html>
